{"version":3,"sources":["../../../../app/dashboard/DashboardClient.tsx/__nextjs-internal-proxy.mjs","../../../../data/users.ts","../../../../node_modules/drizzle-orm/sql/functions/aggregate.js","../../../../app/dashboard/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/dashboard/DashboardClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/dashboard/DashboardClient.tsx\",\n    \"default\",\n);\n","import { db } from '@/lib/db'\nimport { workouts, workoutExercises } from '@/lib/db'\nimport { eq, sum, count, gte, lte, and } from 'drizzle-orm'\nimport { sql } from 'drizzle-orm'\n\n// Prepared statement for user workout statistics (all time)\nconst getUserWorkoutStatsAllTimeStmt = db\n  .select({\n    totalWorkouts: count(workouts.id),\n    totalDuration: sum(sql`COALESCE(${workouts.durationMinutes}, 0)`).mapWith(Number),\n    averageDuration: sql`AVG(COALESCE(${workouts.durationMinutes}, 0))`.mapWith(Number)\n  })\n  .from(workouts)\n  .leftJoin(workoutExercises, eq(workouts.id, workoutExercises.workoutId))\n  .where(eq(workouts.userId, sql.placeholder('userId')))\n  .prepare('getUserWorkoutStatsAllTime')\n\n// Prepared statement for user workout statistics (date filtered) - workouts only\nconst getUserWorkoutStatsByDateRangeStmt = db\n  .select({\n    totalWorkouts: count(workouts.id),\n    totalDuration: sum(sql`COALESCE(${workouts.durationMinutes}, 0)`).mapWith(Number),\n    averageDuration: sql`AVG(COALESCE(${workouts.durationMinutes}, 0))`.mapWith(Number)\n  })\n  .from(workouts)\n  .where(\n    and(\n      eq(workouts.userId, sql.placeholder('userId')),\n      gte(workouts.startedAt, sql.placeholder('startDate')),\n      lte(workouts.startedAt, sql.placeholder('endDate'))\n    )\n  )\n  .prepare('getUserWorkoutStatsByDateRange')\n\nexport async function getUserWorkoutStats(userId: string, startDate?: Date, endDate?: Date) {\n  // Get user's workout statistics\n  if (startDate && endDate) {\n    // Date-specific statistics - workouts only\n    const stats = await getUserWorkoutStatsByDateRangeStmt.execute({\n      userId,\n      startDate,\n      endDate\n    })\n    return stats[0] || {\n      totalWorkouts: 0,\n      totalDuration: 0,\n      averageDuration: 0\n    }\n  } else {\n    // All-time statistics - workouts only\n    const stats = await getUserWorkoutStatsAllTimeStmt.execute({ userId })\n    return stats[0] || {\n      totalWorkouts: 0,\n      totalDuration: 0,\n      averageDuration: 0\n    }\n  }\n}","import { Column } from \"../../column.js\";\nimport { is } from \"../../entity.js\";\nimport { sql } from \"../sql.js\";\nfunction count(expression) {\n  return sql`count(${expression || sql.raw(\"*\")})`.mapWith(Number);\n}\nfunction countDistinct(expression) {\n  return sql`count(distinct ${expression})`.mapWith(Number);\n}\nfunction avg(expression) {\n  return sql`avg(${expression})`.mapWith(String);\n}\nfunction avgDistinct(expression) {\n  return sql`avg(distinct ${expression})`.mapWith(String);\n}\nfunction sum(expression) {\n  return sql`sum(${expression})`.mapWith(String);\n}\nfunction sumDistinct(expression) {\n  return sql`sum(distinct ${expression})`.mapWith(String);\n}\nfunction max(expression) {\n  return sql`max(${expression})`.mapWith(is(expression, Column) ? expression : String);\n}\nfunction min(expression) {\n  return sql`min(${expression})`.mapWith(is(expression, Column) ? expression : String);\n}\nexport {\n  avg,\n  avgDistinct,\n  count,\n  countDistinct,\n  max,\n  min,\n  sum,\n  sumDistinct\n};\n//# sourceMappingURL=aggregate.js.map","import { auth } from \"@clerk/nextjs/server\";\nimport { redirect } from \"next/navigation\";\nimport { getUserWorkoutsByDate } from \"@/data/workouts\";\nimport { getUserWorkoutStats } from \"@/data/users\";\nimport DashboardClient from \"./DashboardClient\";\nimport { parseURLDate, startOfDay, endOfDay } from \"@/lib/utils\";\n\ninterface DashboardPageProps {\n  searchParams: Promise<{\n    date?: string;\n  }>;\n}\n\nexport default async function Dashboard({ searchParams }: DashboardPageProps) {\n  const { userId } = await auth();\n\n  if (!userId) {\n    redirect(\"/\");\n  }\n\n  // Await searchParams and parse date from URL params or use today\n  const params = await searchParams;\n  const selectedDate = params.date\n    ? parseURLDate(params.date)\n    : new Date();\n\n  // Get workouts for the selected date\n  const workouts = await getUserWorkoutsByDate(userId, selectedDate);\n\n  // Get user workout statistics for dashboard summary (filtered by selected date)\n  const dayStart = startOfDay(selectedDate);\n  const dayEnd = endOfDay(selectedDate);\n  const userStats = await getUserWorkoutStats(userId, dayStart, dayEnd);\n\n  return (\n    <DashboardClient\n      workouts={workouts}\n      userStats={userStats}\n      selectedDate={selectedDate}\n    />\n  );\n}"],"names":[],"mappings":"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","ignoreList":[0,2]}